%% Parser State Machine
%% Shows how the scanner maintains state while processing directives

stateDiagram-v2
    [*] --> Idle: Start scanning file

    Idle --> Idle: Non-doc line<br/>(clears pending)
    Idle --> CollectingDocs: ## directive

    CollectingDocs --> CollectingDocs: ## doc line<br/>(append to pending)
    CollectingDocs --> CollectingDocs: ## !var<br/>(add to pendingVars)
    CollectingDocs --> CollectingDocs: ## !alias<br/>(set pendingAliases)
    CollectingDocs --> CategorySet: ## !category X
    CollectingDocs --> FileDoc: ## !file
    CollectingDocs --> Idle: target:<br/>(emit target with pending)

    CategorySet --> CollectingDocs: ## doc line
    CategorySet --> CategorySet: ## !category Y<br/>(update current)
    CategorySet --> Idle: target:<br/>(emit with category)

    FileDoc --> Idle: ## !file content<br/>(emit file directive)
    FileDoc --> CollectingDocs: ## doc line

    note right of CollectingDocs
        Pending state:
        - pendingDocs[]
        - pendingVars[]
        - pendingAliases
        - currentCategory (sticky)
    end note

    note right of CategorySet
        Category is STICKY:
        applies to all subsequent
        targets until changed
    end note
